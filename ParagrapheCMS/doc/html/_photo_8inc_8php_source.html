<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>CMSCroisix:  Fichier source de class/Photo.inc.php</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Généré par Doxygen 1.6.2 -->
  <div class="navpath"><a class="el" href="dir_a0b1ff84f080d2ce1409d6712f25da0e.html">class</a>
  </div>
<div class="contents">
<h1>Photo.inc.php</h1><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 &lt;?php 
<a name="l00009"></a><a class="code" href="class_photo.html">00009</a> <span class="keyword">class </span><a class="code" href="class_photo.html">Photo</a> {
<a name="l00014"></a><a class="code" href="class_photo.html#a4cc09bc1b9e1430b02252d2b03a01c1a">00014</a>     <span class="keyword">public</span> <a class="code" href="class_photo.html#a4cc09bc1b9e1430b02252d2b03a01c1a">$numphoto</a>;
<a name="l00019"></a><a class="code" href="class_photo.html#af123f5959cb8c87ca5b9113e7168361a">00019</a>     <span class="keyword">public</span> <a class="code" href="class_photo.html#af123f5959cb8c87ca5b9113e7168361a">$nomPhoto</a>;
<a name="l00024"></a>00024         <span class="keyword">public</span> $tmp_name;
<a name="l00029"></a><a class="code" href="class_photo.html#a0ddf78d333a4f510c0824f5c3282b43e">00029</a>         <span class="keyword">public</span> <a class="code" href="class_photo.html#a0ddf78d333a4f510c0824f5c3282b43e">$legendePhoto</a>;
<a name="l00034"></a><a class="code" href="class_photo.html#ad6cdc748f8e159b1182642381fe47b47">00034</a>         <span class="keyword">public</span> <a class="code" href="class_photo.html#ad6cdc748f8e159b1182642381fe47b47">$ordrePhoto</a>;
<a name="l00039"></a>00039         <span class="keyword">public</span> $logo; 
<a name="l00044"></a><a class="code" href="class_photo.html#a5d55051adfe3a530851c3b81db5e10f0">00044</a>         <span class="keyword">public</span> <a class="code" href="class_photo.html#a5d55051adfe3a530851c3b81db5e10f0">$taille</a>;
<a name="l00049"></a><a class="code" href="class_photo.html#a84eda36b6ad742086dd625bd70b14ca5">00049</a>         <span class="keyword">public</span> <a class="code" href="class_photo.html#a84eda36b6ad742086dd625bd70b14ca5">$numparaphoto</a>; 
<a name="l00055"></a><a class="code" href="class_photo.html#a049f2aa4a5739c1ad89a6b83cf5f8a76">00055</a>         <span class="keyword">public</span> <a class="code" href="class_photo.html#a049f2aa4a5739c1ad89a6b83cf5f8a76" title="indique qu&amp;#39;on modifie la photo">$modif</a>;
<a name="l00060"></a><a class="code" href="class_photo.html#aec32ea621dcf5476ee4c402a8d2c99f8">00060</a>         <span class="keyword">public</span> <a class="code" href="class_photo.html#aec32ea621dcf5476ee4c402a8d2c99f8">$ext</a>;
<a name="l00065"></a><a class="code" href="class_photo.html#a85e90cff40290f517e53fb630f1267b1">00065</a>         function <a class="code" href="class_photo.html#a85e90cff40290f517e53fb630f1267b1">creerPhoto</a>() {
<a name="l00066"></a>00066            <span class="comment">// Gestion de la photo</span>
<a name="l00067"></a>00067                 <span class="comment">//$tmp_fich=$this-&gt;nomPhoto; </span>
<a name="l00068"></a>00068                 <span class="keywordflow">if</span> ($this-&gt;modif) $chem=<span class="stringliteral">&quot;../&quot;</span>;
<a name="l00069"></a>00069                 $liste=explode(<span class="stringliteral">&quot;.&quot;</span>,$this-&gt;nomPhoto);
<a name="l00070"></a>00070             <span class="keywordflow">if</span> ($liste[4]) <a class="code" href="class_photo.html#aec32ea621dcf5476ee4c402a8d2c99f8">$ext</a>=$liste[4]; <span class="keywordflow">else</span> <span class="keywordflow">if</span> ($liste[3]) <a class="code" href="class_photo.html#aec32ea621dcf5476ee4c402a8d2c99f8">$ext</a>=$liste[3]; <span class="keywordflow">else</span> <span class="keywordflow">if</span> ($liste[2]) <a class="code" href="class_photo.html#aec32ea621dcf5476ee4c402a8d2c99f8">$ext</a>=$liste[2]; <span class="keywordflow">else</span> <a class="code" href="class_photo.html#aec32ea621dcf5476ee4c402a8d2c99f8">$ext</a>=$liste[1]; 
<a name="l00071"></a>00071             $nom_photo=$liste[0].<span class="stringliteral">&quot;.&quot;</span>.<a class="code" href="class_photo.html#aec32ea621dcf5476ee4c402a8d2c99f8">$ext</a>;       
<a name="l00072"></a>00072                 <span class="keywordflow">if</span> ($this-&gt;taille) { <span class="comment">//on a une taille de spcifie</span>
<a name="l00073"></a>00073                         <span class="keywordflow">if</span> (<a class="code" href="class_photo.html#aec32ea621dcf5476ee4c402a8d2c99f8">$ext</a>==<span class="stringliteral">&quot;jpg&quot;</span>) {         
<a name="l00074"></a>00074                                 @move_uploaded_file($this-&gt;tmp_name, $chem.<span class="stringliteral">&quot;photos/&quot;</span>.$nom_photo);       
<a name="l00075"></a>00075                                 $log=$nom_photo;
<a name="l00076"></a>00076                                 @copy($chem.<span class="stringliteral">&quot;photos/&quot;</span>.$nom_photo, $chem.<span class="stringliteral">&quot;photos/o&quot;</span>.$nom_photo); 
<a name="l00077"></a>00077                                 <span class="keywordflow">if</span> ($this-&gt;taille) $this-&gt;<a class="code" href="class_photo.html#ad90cf2570ab0d6f5cb1792e4fa51e3a4">redimPhoto</a>($chem.<span class="stringliteral">&quot;photos/&quot;</span>,$log,$this-&gt;taille);       
<a name="l00078"></a>00078                                 @unlink($chem.<span class="stringliteral">&quot;photos/o&quot;</span>.$nom_photo);   
<a name="l00079"></a>00079                     } <span class="keywordflow">else</span> {
<a name="l00080"></a>00080                                 @move_uploaded_file($this-&gt;tmp_name, $chem.<span class="stringliteral">&quot;photos/&quot;</span>.$nom_photo);       
<a name="l00081"></a>00081                     }
<a name="l00082"></a>00082             } <span class="keywordflow">else</span> {
<a name="l00083"></a>00083                         @move_uploaded_file($this-&gt;tmp_name, $chem.<span class="stringliteral">&quot;photos/&quot;</span>.$nom_photo);       
<a name="l00084"></a>00084                 }
<a name="l00085"></a>00085                 mysql_query(<span class="stringliteral">&quot;INSERT INTO if_photo (nom_photo) VALUES (&#39;$nom_photo&#39;)&quot;</span>);
<a name="l00086"></a>00086                 $this-&gt;numphoto=mysql_insert_id();
<a name="l00100"></a>00100                 <span class="keywordflow">return</span> $this-&gt;numphoto; 
<a name="l00101"></a>00101         }
<a name="l00102"></a>00102         
<a name="l00103"></a>00103         function modifierPhoto() {
<a name="l00104"></a>00104                 
<a name="l00105"></a>00105         }
<a name="l00109"></a><a class="code" href="class_photo.html#a5359e24097370106b9da6e7ebc350367">00109</a>         function <a class="code" href="class_photo.html#a5359e24097370106b9da6e7ebc350367">supprimerPhoto</a>() {
<a name="l00110"></a>00110                 $this-&gt;<a class="code" href="class_photo.html#af5566ebc3765ff109ea5494119f6e9c1">infosPhoto</a>();
<a name="l00111"></a>00111                 <span class="keywordflow">if</span> ($this-&gt;modif) $chem=<span class="stringliteral">&quot;../&quot;</span>;
<a name="l00112"></a>00112                 <span class="keywordflow">if</span> (file_exists($chem.<span class="stringliteral">&quot;photos/&quot;</span>.$this-&gt;nomPhoto)) @unlink($chem.<span class="stringliteral">&quot;photos/&quot;</span>.$this-&gt;nomPhoto);
<a name="l00113"></a>00113                 mysql_query(<span class="stringliteral">&quot;DELETE FROM if_photo WHERE numphoto=&#39;$this-&gt;numphoto&#39;&quot;</span>);   
<a name="l00114"></a>00114         }
<a name="l00122"></a><a class="code" href="class_photo.html#ad90cf2570ab0d6f5cb1792e4fa51e3a4">00122</a>         function <a class="code" href="class_photo.html#ad90cf2570ab0d6f5cb1792e4fa51e3a4">redimPhoto</a>($chemin,$photo,<a class="code" href="class_photo.html#a5d55051adfe3a530851c3b81db5e10f0">$taille</a>) {
<a name="l00123"></a>00123                 <span class="comment">//redimensionnement photo petit format</span>
<a name="l00124"></a>00124                 $size=getimagesize($chemin.<span class="stringliteral">&quot;o&quot;</span>.$photo);
<a name="l00125"></a>00125                 <span class="keywordflow">if</span> (($size[0]&gt;<a class="code" href="class_photo.html#a5d55051adfe3a530851c3b81db5e10f0">$taille</a>) || ($size[1]&gt;<a class="code" href="class_photo.html#a5d55051adfe3a530851c3b81db5e10f0">$taille</a>)) {
<a name="l00126"></a>00126                 
<a name="l00127"></a>00127                         <span class="keywordflow">if</span> ($size[0]&gt;$size[1]) {<span class="comment">// largeur suprieure  la hauteur                                </span>
<a name="l00128"></a>00128                                 $wg=<a class="code" href="class_photo.html#a5d55051adfe3a530851c3b81db5e10f0">$taille</a>;
<a name="l00129"></a>00129                                 $hg=number_format($size[1]/($size[0]/<a class="code" href="class_photo.html#a5d55051adfe3a530851c3b81db5e10f0">$taille</a>),0,<span class="stringliteral">&quot;,&quot;</span>,<span class="stringliteral">&quot;&quot;</span>);                                                                        
<a name="l00130"></a>00130                         } <span class="keywordflow">else</span> {<span class="comment">// hauteur suprieure  la largeur                                </span>
<a name="l00131"></a>00131                                 $hg=<a class="code" href="class_photo.html#a5d55051adfe3a530851c3b81db5e10f0">$taille</a>;
<a name="l00132"></a>00132                                 $wg=number_format($size[0]/($size[1]/<a class="code" href="class_photo.html#a5d55051adfe3a530851c3b81db5e10f0">$taille</a>),0,<span class="stringliteral">&quot;,&quot;</span>,<span class="stringliteral">&quot;&quot;</span>);                                
<a name="l00133"></a>00133                         }       
<a name="l00134"></a>00134                                                 
<a name="l00135"></a>00135                 } <span class="keywordflow">else</span> {                        
<a name="l00136"></a>00136                         $wg=$size[0];
<a name="l00137"></a>00137                         $hg=$size[1];                   
<a name="l00138"></a>00138                 }
<a name="l00139"></a>00139         
<a name="l00140"></a>00140                 $src_img = imagecreatefromjpeg($chemin.<span class="stringliteral">&quot;o&quot;</span>.$photo); 
<a name="l00141"></a>00141                 $dst_img = imagecreatetruecolor($wg,$hg); 
<a name="l00142"></a>00142                 imagecopyresampled($dst_img, $src_img, 0, 0, 0, 0, $wg, $hg, $size[0], $size[1]);
<a name="l00143"></a>00143                 Imagejpeg($dst_img, $chemin.$photo,100);
<a name="l00144"></a>00144         }
<a name="l00149"></a><a class="code" href="class_photo.html#a6202b4ee023f93195b9ebdff56522c6f">00149</a>         function <a class="code" href="class_photo.html#a6202b4ee023f93195b9ebdff56522c6f">countPhotos</a>() {
<a name="l00150"></a>00150                  <span class="keywordflow">return</span> SelectCount(<span class="stringliteral">&quot;numparaphoto&quot;</span>,<span class="stringliteral">&quot;if_para_photo&quot;</span>,<span class="stringliteral">&quot;numphoto&quot;</span>,$this-&gt;numphoto);
<a name="l00151"></a>00151         }
<a name="l00155"></a><a class="code" href="class_photo.html#af5566ebc3765ff109ea5494119f6e9c1">00155</a>         function <a class="code" href="class_photo.html#af5566ebc3765ff109ea5494119f6e9c1">infosPhoto</a>() {
<a name="l00156"></a>00156                 <span class="keywordflow">if</span> ($this-&gt;numparaphoto) {
<a name="l00157"></a>00157                         $row=SelectMultiple(<span class="stringliteral">&quot;if_para_photo&quot;</span>,<span class="stringliteral">&quot;numparaphoto&quot;</span>,$this-&gt;numparaphoto);
<a name="l00158"></a>00158                         $this-&gt;legendePhoto=$row[<span class="stringliteral">&quot;legende&quot;</span>];
<a name="l00159"></a>00159                         $this-&gt;ordrePhoto=$row[<span class="stringliteral">&quot;ordre&quot;</span>];
<a name="l00160"></a>00160                         $this-&gt;numphoto=$row[<span class="stringliteral">&quot;numphoto&quot;</span>];
<a name="l00161"></a>00161                         $row=SelectMultiple(<span class="stringliteral">&quot;if_photo&quot;</span>,<span class="stringliteral">&quot;numphoto&quot;</span>,$this-&gt;numphoto);
<a name="l00162"></a>00162                         $this-&gt;nomPhoto=$row[<span class="stringliteral">&quot;nom_photo&quot;</span>];
<a name="l00163"></a>00163                         $liste=explode(<span class="stringliteral">&quot;.&quot;</span>,$this-&gt;nomPhoto);
<a name="l00164"></a>00164                 <span class="keywordflow">if</span> ($liste[4]) $this-&gt;ext=$liste[4]; <span class="keywordflow">else</span> <span class="keywordflow">if</span> ($liste[3]) $this-&gt;ext=$liste[3]; <span class="keywordflow">else</span> <span class="keywordflow">if</span> ($liste[2]) $this-&gt;ext=$liste[2]; <span class="keywordflow">else</span> $this-&gt;ext=$liste[1]; 
<a name="l00165"></a>00165                 
<a name="l00166"></a>00166                 } <span class="keywordflow">else</span> {
<a name="l00167"></a>00167                         $row=SelectMultiple(<span class="stringliteral">&quot;if_photo&quot;</span>,<span class="stringliteral">&quot;numphoto&quot;</span>,$this-&gt;numphoto);
<a name="l00168"></a>00168                         $this-&gt;nomPhoto=$row[<span class="stringliteral">&quot;nom_photo&quot;</span>];
<a name="l00169"></a>00169                         $liste=explode(<span class="stringliteral">&quot;.&quot;</span>,$this-&gt;nomPhoto);
<a name="l00170"></a>00170                 <span class="keywordflow">if</span> ($liste[4]) $this-&gt;ext=$liste[4]; <span class="keywordflow">else</span> <span class="keywordflow">if</span> ($liste[3]) $this-&gt;ext=$liste[3]; <span class="keywordflow">else</span> <span class="keywordflow">if</span> ($liste[2]) $this-&gt;ext=$liste[2]; <span class="keywordflow">else</span> $this-&gt;ext=$liste[1]; 
<a name="l00171"></a>00171                 }
<a name="l00172"></a>00172                 <span class="comment">//$this-&gt;legende=$row[&quot;legende&quot;];</span>
<a name="l00173"></a>00173         }
<a name="l00174"></a>00174 }
<a name="l00175"></a>00175 
<a name="l00176"></a>00176 ?&gt;
</pre></div></div>
<hr size="1"/><address style="text-align: right;"><small>Généré par&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.2 </small></address>
</body>
</html>
